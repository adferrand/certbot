schedules:
- cron: "0 0 * * *"
  displayName: Nightly build
  branches:
    include:
    - master

jobs:
  - template: templates/standard.yml

  - job: installer
    pool:
      vmImage: windows-latest
    steps:
    - task: UsePythonVersion@0
      inputs:
        versionSpec: 3.7
        architecture: x86
        addToPath: true
    - script: python windows-installer/construct.py
      displayName: Build Certbot installer
    - script: python windows-installer/install.py
      displayName: Run Certbot installer
    - script: |
        python -m venv venv
        venv\Scripts\python tools\pip_install.py -e certbot-ci
      displayName: Install Certbot CI
    - script: |
        set CERTBOT_EXECUTABLE_PATH="%ProgramFiles(x86)%\Certbot\bin\certbot.exe"
        venv\Scripts\python -m pytest certbot-ci\certbot_integration_tests\certbot_tests -n 4
      displayName: Run integration tests